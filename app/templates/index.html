<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player Fantasy Stats</title>
    
    <!-- Include modern DataTables with Bootstrap styling -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.1/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.4.0/css/responsive.bootstrap5.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/2.3.2/css/buttons.bootstrap5.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/searchbuilder/1.4.0/css/searchBuilder.bootstrap5.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/fixedheader/3.3.1/css/fixedHeader.bootstrap5.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/colreorder/1.6.1/css/colReorder.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --accent-color: #e74c3c;
            --light-bg: #f8f9fa;
            --dark-bg: #2c3e50;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 0;
            margin: 0;
            background-color: var(--light-bg);
            color: #333;
        }
        
        .header {
            background-color: var(--dark-bg);
            color: white;
            padding: 20px 0;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            margin: 0;
            font-weight: 700;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .filters-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .filters-title {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            color: var(--secondary-color);
        }
        
        .filters-title i {
            margin-right: 10px;
            color: var(--primary-color);
        }
        
        .filter-control {
            margin-bottom: 15px;
        }
        
        .filter-label {
            font-weight: 600;
            margin-bottom: 5px;
            display: block;
            color: var(--secondary-color);
        }
        
        .table-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            overflow-x: auto;
        }
        
        table.dataTable {
            border-collapse: collapse !important;
            width: 100% !important;
        }
        
        table.dataTable thead th {
            background-color: var(--primary-color);
            color: white;
            padding: 12px 8px;
            font-weight: 600;
            white-space: nowrap;
        }
        
        table.dataTable tbody tr:nth-of-type(odd) {
            background-color: rgba(0, 0, 0, 0.02);
        }
        
        table.dataTable tbody tr:hover {
            background-color: rgba(52, 152, 219, 0.1);
        }
        
        .dataTables_wrapper .dataTables_paginate .paginate_button.current {
            background: var(--primary-color) !important;
            border-color: var(--primary-color) !important;
            color: white !important;
        }
        
        .btn-filter {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .btn-filter:hover {
            background-color: #2980b9;
        }
        
        .btn-reset {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .btn-reset:hover {
            background-color: #c0392b;
        }
        
        .stat-highlight {
            font-weight: bold;
            color: var(--primary-color);
        }
        
        /* Column categories styling */
        .col-offensive {
            background-color: rgba(52, 152, 219, 0.1);
        }
        
        .col-defensive {
            background-color: rgba(46, 204, 113, 0.1);
        }
        
        .col-misc {
            background-color: rgba(155, 89, 182, 0.1);
        }
        
        .column-toggle-btn {
            margin: 2px;
            padding: 4px 10px;
            font-size: 0.85rem;
        }
        
        .column-toggle-btn.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .column-toggles {
            margin-bottom: 15px;
        }
        
        .column-group {
            margin-bottom: 10px;
            padding: 0 5px;
        }
        
        .table-info {
            font-size: 0.9rem;
            color: #666;
            margin-top: 10px;
        }
        
        .table-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        @media (max-width: 768px) {
            .filters-row {
                flex-direction: column;
            }
            
            .filter-control {
                width: 100%;
                margin-right: 0;
            }
            
            .table-container {
                padding: 10px;
            }
            
            table.dataTable {
                display: block;
                width: 100%;
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container-fluid">
            <div class="header-content">
                <h1><i class="fas fa-futbol me-2"></i>Player Fantasy Stats</h1>
                <div class="d-none d-md-block">
                    <button class="btn btn-outline-light" id="toggleDarkMode">
                        <i class="fas fa-moon"></i> Dark Mode
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <!-- Filter Options Card -->
        <div class="filters-card">
            <div class="filters-title">
                <i class="fas fa-filter fa-lg"></i>
                <h4 class="mb-0">Filter Players</h4>
            </div>
            
            <div class="row filters-row">
                <div class="col-md-3 filter-control">
                    <label class="filter-label" for="position-filter">Position:</label>
                    <select class="form-select" id="position-filter">
                        <option value="">All Positions</option>
                        <option value="GK">Goalkeeper (GK)</option>
                        <option value="DEF">Defense (DEF)</option>
                        <option value="MID">Midfield (MID)</option>
                        <option value="FWD">Forward (FWD)</option>
                    </select>
                </div>
                
                <div class="col-md-3 filter-control">
                    <label class="filter-label" for="goal-filter">Goals (Min):</label>
                    <input type="number" class="form-control" id="goal-filter" placeholder="Min goals">
                </div>
                
                <div class="col-md-3 filter-control">
                    <label class="filter-label" for="assist-filter">Assists (Min):</label>
                    <input type="number" class="form-control" id="assist-filter" placeholder="Min assists">
                </div>
                
                <div class="col-md-3 filter-control">
                    <label class="filter-label" for="points-filter">Total Points (Min):</label>
                    <input type="number" class="form-control" id="points-filter" placeholder="Min points">
                </div>
            </div>

            <!-- Price Filter -->
            <div class="col-md-3 filter-control">
                <label class="filter-label" for="price-filter">Price (Min):</label>
                <select class="form-select" id="price-filter">
                    <option value="">Select Price Range</option>
                    <option value="4000000">4M</option>
                    <option value="4500000">4.5M</option>
                    <option value="5000000">5M</option>
                    <option value="5500000">5.5M</option>
                    <option value="6000000">6M</option>
                    <option value="6500000">6.5M</option>
                    <option value="7000000">7M</option>
                    <option value="7500000">7.5M</option>
                    <option value="8000000">8M</option>
                    <option value="8500000">8.5M</option>
                    <option value="9000000">9M</option>
                    <option value="9500000">9.5M</option>
                    <option value="10000000">10M</option>
                    <option value="10500000">10.5M</option>
                    <option value="11000000">11M</option>
                    <option value="11500000">11.5M</option>
                    <option value="12000000">12M</option>
                    <option value="12500000">12.5M</option>
                    <option value="13000000">13M</option>
                    <option value="13500000">13.5M</option>
                    <option value="14000000">14M</option>
                    <option value="14500000">14.5M</option>
                    <option value="15000000">15M</option>
                </select>
            </div>

             <!-- Price Max Filter -->
             <div class="col-md-3 filter-control">
                <label class="filter-label" for="price-max-filter">Price (Max):</label>
                <select class="form-select" id="price-max-filter">
                    <option value="">Select Max Price</option>
                    <option value="4000000">4M</option>
                    <option value="4500000">4.5M</option>
                    <option value="5000000">5M</option>
                    <option value="5500000">5.5M</option>
                    <option value="6000000">6M</option>
                    <option value="6500000">6.5M</option>
                    <option value="7000000">7M</option>
                    <option value="7500000">7.5M</option>
                    <option value="8000000">8M</option>
                    <option value="8500000">8.5M</option>
                    <option value="9000000">9M</option>
                    <option value="9500000">9.5M</option>
                    <option value="10000000">10M</option>
                    <option value="10500000">10.5M</option>
                    <option value="11000000">11M</option>
                    <option value="11500000">11.5M</option>
                    <option value="12000000">12M</option>
                    <option value="12500000">12.5M</option>
                    <option value="13000000">13M</option>
                    <option value="13500000">13.5M</option>
                    <option value="14000000">14M</option>
                    <option value="14500000">14.5M</option>
                    <option value="15000000">15M</option>
                </select>
            </div>
            
            <div class="d-flex justify-content-end mt-3">
                <button id="reset-filters" class="btn-reset me-2">
                    <i class="fas fa-undo-alt me-1"></i> Reset
                </button>
                <button id="apply-filters" class="btn-filter">
                    <i class="fas fa-search me-1"></i> Apply Filters
                </button>
            </div>
        </div>

        <!-- Column Toggles Section -->
        <div class="filters-card column-toggles">
            <div class="filters-title">
                <i class="fas fa-table-columns fa-lg"></i>
                <h4 class="mb-0">Column Visibility</h4>
            </div>
            
            <div class="row">
                <div class="col-md-12">
                    <div class="d-flex flex-wrap mt-2">
                        <div class="column-group">
                            <span class="badge bg-primary mb-2">Basic Info</span><br>
                            <button class="btn btn-sm btn-outline-secondary column-toggle-btn active" data-column="0">Player ID</button>
                            <button class="btn btn-sm btn-outline-secondary column-toggle-btn active" data-column="1">Name</button>
                            <button class="btn btn-sm btn-outline-secondary column-toggle-btn active" data-column="2">Team</button>
                            <button class="btn btn-sm btn-outline-secondary column-toggle-btn active" data-column="3">Cost</button>
                            <button class="btn btn-sm btn-outline-secondary column-toggle-btn active" data-column="4">Owned By</button>
                            <button class="btn btn-sm btn-outline-secondary column-toggle-btn active" data-column="7">Positions</button>
                        </div>
                        <div class="column-group">
                            <span class="badge bg-success mb-2">Point Stats</span><br>
                            <button class="btn btn-sm btn-outline-secondary column-toggle-btn active" data-column="5">Total Points</button>
                            <button class="btn btn-sm btn-outline-secondary column-toggle-btn active" data-column="6">Average Points</button>
                            <button class="btn btn-sm btn-outline-secondary column-toggle-btn active" data-column="8">Combined Pts</button>
                        </div>
                        <div class="column-group">
                            <span class="badge bg-danger mb-2">Offensive</span><br>
                            <button class="btn btn-sm btn-outline-secondary column-toggle-btn" data-column="10">Goals</button>
                            <button class="btn btn-sm btn-outline-secondary column-toggle-btn" data-column="11">Assists</button>
                            <button class="btn btn-sm btn-outline-secondary column-toggle-btn" data-column="12">Yellow Cards</button>
                            <button class="btn btn-sm btn-outline-secondary column-toggle-btn" data-column="13">Red Cards</button>
                            <button class="btn btn-sm btn-outline-secondary column-toggle-btn" data-column="14">Goals Conceded</button>
                            <button class="btn btn-sm btn-outline-secondary column-toggle-btn" data-column="15">Clean Sheets</button>
                            <button class="btn btn-sm btn-outline-secondary column-toggle-btn" data-column="16">Shots on Goal</button>
                            <button class="btn btn-sm btn-outline-secondary column-toggle-btn" data-column="17">Penalty Scored</button>
                            <button class="btn btn-sm btn-outline-secondary column-toggle-btn" data-column="18">Penalty Missed</button>
                            <button class="btn btn-sm btn-outline-secondary column-toggle-btn" data-column="19">Own Goals</button>
                            <button class="btn btn-sm btn-outline-secondary column-toggle-btn" data-column="20">Saved Goals</button>
                            <button class="btn btn-sm btn-outline-secondary column-toggle-btn" data-column="21">Fouls</button>
                        </div>
                        <div class="column-group">
                            <span class="badge bg-info mb-2">Defensive</span><br>
                            <button class="btn btn-sm btn-outline-secondary column-toggle-btn" data-column="22">Pass Success</button>
                            <button class="btn btn-sm btn-outline-secondary column-toggle-btn" data-column="23">Aerial Passes</button>
                            <button class="btn btn-sm btn-outline-secondary column-toggle-btn" data-column="24">Key Passes</button>
                            <button class="btn btn-sm btn-outline-secondary column-toggle-btn" data-column="25">Crosses</button>
                            <button class="btn btn-sm btn-outline-secondary column-toggle-btn" data-column="26">Assist Goals</button>
                            <button class="btn btn-sm btn-outline-secondary column-toggle-btn" data-column="27">Shots</button>
                        </div>
                        <div class="column-group">
                            <span class="badge bg-warning text-dark mb-2">Other Stats</span><br>
                            <button class="btn btn-sm btn-outline-secondary column-toggle-btn" data-column="28">Clearances</button>
                            <button class="btn btn-sm btn-outline-secondary column-toggle-btn" data-column="29">Interceptions</button>
                            <button class="btn btn-sm btn-outline-secondary column-toggle-btn" data-column="30">Won Fouls</button>
                        </div>
                    </div>

                    <div class="mt-3">
                        <button id="show-all-columns" class="btn btn-sm btn-outline-primary me-2">
                            <i class="fas fa-eye me-1"></i> Show All
                        </button>
                        <button id="hide-all-columns" class="btn btn-sm btn-outline-secondary me-2">
                            <i class="fas fa-eye-slash me-1"></i> Hide All
                        </button>
                        <button id="restore-default-columns" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-undo me-1"></i> Default View
                        </button>
                    </div>
            </div>
        </div>

        <!-- Table Container -->
        <div class="table-container">
            <div class="table-controls">
                <div>
                    <button class="btn btn-sm btn-outline-primary me-2" id="export-csv">
                        <i class="fas fa-file-export me-1"></i> Export CSV
                    </button>
                    <button class="btn btn-sm btn-outline-secondary" id="toggle-search-builder">
                        <i class="fas fa-sliders me-1"></i> Advanced Filters
                    </button>
                </div>
                <div class="table-info">
                    <i class="fas fa-info-circle me-1"></i> Scroll horizontally to see all stats
                </div>
            </div>
            
            <div id="search-builder-container" style="display: none; margin-bottom: 20px;"></div>
            
            <table id="player-stats" class="table table-striped table-hover display nowrap" width="100%">
                <thead>
                    <tr>
                        <th>Player ID</th>
                        <th>Name</th>
                        <th>Team</th>
                        <th>Cost</th>
                        <th>Owned By</th>
                        <th>Total Points</th>
                        <th>Average Points</th>
                        <th>Positions</th>
                        <th>Combined Pts</th>
                        <th>Minutes</th>
                        <th>Goals</th>
                        <th>Assists</th>
                        <th>Yellow Cards</th>
                        <th>Red Cards</th>
                        <th>Goals Conceded</th>
                        <th>Clean Sheets</th>
                        <th>Shots on Goal</th>
                        <th>Penalty Scored</th>
                        <th>Penalty Missed</th>
                        <th>Own Goals</th>
                        <th>Saved Goals</th>
                        <th>Fouls</th>
                        <th>Pass Success</th>
                        <th>Aerial Passes</th>
                        <th>Key Passes</th>
                        <th>Crosses</th>
                        <th>Assist Goals</th>
                        <th>Shots</th>
                        <th>Clearances</th>
                        <th>Interceptions</th>
                        <th>Won Fouls</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in data %}
                    <tr>
                        <td>{{ row['Player ID'] }}</td>
                        <td>{{ row['Name'] }}</td>
                        <td>{{ row['Team'] }}</td>
                        <td>{{ row['Cost'] }}</td>
                        <td>{{ row['Owned By'] }}</td>
                        <td class="stat-highlight">{{ row['Total Points'] }}</td>
                        <td>{{ row['Average Points'] }}</td>
                        <td>{{ row['Positions'] }}</td>
                        <td>{{ row['Total Combined Points'] }}</td>
                        <td>{{ row['Total MIN Points'] }}</td>
                        <td>{{ row['Total GL Points'] }}</td>
                        <td>{{ row['Total ASS Points'] }}</td>
                        <td>{{ row['Total YC Points'] }}</td>
                        <td>{{ row['Total RC Points'] }}</td>
                        <td>{{ row['Total GC Points'] }}</td>
                        <td>{{ row['Total CS Points'] }}</td>
                        <td>{{ row['Total GS Points'] }}</td>
                        <td>{{ row['Total PS Points'] }}</td>
                        <td>{{ row['Total PM Points'] }}</td>
                        <td>{{ row['Total OG Points'] }}</td>
                        <td>{{ row['Total SGS Points'] }}</td>
                        <td>{{ row['Total FS Points'] }}</td>
                        <td>{{ row['Total PSS Points'] }}</td>
                        <td>{{ row['Total APS Points'] }}</td>
                        <td>{{ row['Total KP Points'] }}</td>
                        <td>{{ row['Total CRS Points'] }}</td>
                        <td>{{ row['Total ASG Points'] }}</td>
                        <td>{{ row['Total SH Points'] }}</td>
                        <td>{{ row['Total CL Points'] }}</td>
                        <td>{{ row['Total INT Points'] }}</td>
                        <td>{{ row['Total WF Points'] }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

    <!-- Include JavaScript libraries -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.1/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.1/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.2/js/buttons.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/searchbuilder/1.4.0/js/dataTables.searchBuilder.min.js"></script>
    <script src="https://cdn.datatables.net/searchbuilder/1.4.0/js/searchBuilder.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/fixedheader/3.3.1/js/dataTables.fixedHeader.min.js"></script>
    <script src="https://cdn.datatables.net/colreorder/1.6.1/js/dataTables.colReorder.min.js"></script>

    <script>
        $(document).ready(function() {
            // Initialize DataTable with more modern features
            var table = $('#player-stats').DataTable({
                scrollX: true,
                fixedHeader: true,
                colReorder: true,
                dom: '<"top"f>rt<"bottom"lip>',
                ordering: true,
                pageLength: 15,
                language: {
                    search: "<i class='fas fa-search'></i> Search:",
                    paginate: {
                        first: "<i class='fas fa-angle-double-left'></i>",
                        last: "<i class='fas fa-angle-double-right'></i>",
                        previous: "<i class='fas fa-angle-left'></i>",
                        next: "<i class='fas fa-angle-right'></i>"
                    }
                },
                // Default column visibility - hide some columns initially for better readability
                columnDefs: [
                    // Update these indexes to reflect new column structure (with Team added)
                    { targets: [8, 12, 13, 17, 18, 19, 20, 21, 22, 23, 25, 26, 27, 28, 29, 30], visible: false }
                ],
                // Initialize with search builder but not shown
                searchBuilder: {
                    container: $('#search-builder-container')
                }
            });
            
            syncButtonStates();
            
            // Add advanced filter toggle
            $('#toggle-search-builder').on('click', function() {
                $('#search-builder-container').toggle();
                if ($('#search-builder-container').is(':visible')) {
                    $(this).html('<i class="fas fa-times me-1"></i> Hide Advanced Filters');
                    table.searchBuilder.rebuild();
                } else {
                    $(this).html('<i class="fas fa-sliders me-1"></i> Advanced Filters');
                }
            });
            
            // Export CSV button
            $('#export-csv').on('click', function() {
                // In a real implementation, this would generate and download a CSV
                alert('Export functionality would be implemented here in a real app');
            });
            
            // Column toggle buttons
            $('.column-toggle-btn').on('click', function() {
                const columnIndex = parseInt($(this).data('column'));
                const column = table.column(columnIndex);
                
                // Toggle column visibility
                column.visible(!column.visible());
                
                // Update this button's state
                $(this).toggleClass('active', column.visible());
            });
            
            // Show all columns
            $('#show-all-columns').on('click', function() {
                table.columns().visible(true);
                $('.column-toggle-btn').addClass('active');
                syncButtonStates();
            });
            
            // Hide all columns
            $('#hide-all-columns').on('click', function() {
                // Keep at least the name column visible
                table.columns().visible(false);
                table.column(1).visible(true);
                syncButtonStates();
                $('.column-toggle-btn').removeClass('active');
                $('.column-toggle-btn[data-column="1"]').addClass('active');
            });
            
            // Restore default view
            $('#restore-default-columns').on('click', function() {
                // First, hide all columns
                table.columns().visible(false);
                
                // Define which columns should be visible by default
                const visibleColumns = [0, 1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 14, 15, 16, 24];
                syncButtonStates();
                // Make those columns visible
                table.columns(visibleColumns).visible(true);
                
                // Update all toggle buttons to match table state
                $('.column-toggle-btn').each(function() {
                    const columnIndex = parseInt($(this).data('column'));
                    $(this).toggleClass('active', visibleColumns.includes(columnIndex));
                });
            });
    
            // Add this function to synchronize button states with actual column visibility
            function syncButtonStates() {
                $('.column-toggle-btn').each(function() {
                    const columnIndex = parseInt($(this).data('column'));
                    const isVisible = table.column(columnIndex).visible();
                    $(this).toggleClass('active', isVisible);
                });
            }
            
            // Apply filters button logic
            $('#apply-filters').on('click', function() {
                applyFilters();
            });
    
            $('#reset-filters').on('click', function() {
                // Reset text inputs
                $('#goal-filter').val('');
                $('#assist-filter').val('');
                $('#points-filter').val('');
                
                // Reset select elements - use multiple approaches for greater reliability
                // Position filter
                $('#position-filter').val('').prop('selectedIndex', 0).trigger('change');
                
                // Price min filter - use multiple approaches
                $('#price-filter').val('').prop('selectedIndex', 0).trigger('change');
                
                // Price max filter - use multiple approaches with verification
                if ($('#price-max-filter').length > 0) {
                    $('#price-max-filter').val('');
                    $('#price-max-filter').prop('selectedIndex', 0);
                    $('#price-max-filter').trigger('change');
                }
                
                // Ensure the UI reflects the changes by forcing a redraw
                setTimeout(function() {
                    // Clear all DataTables filters
                    $.fn.dataTable.ext.search = [];
                    table.search('').columns().search('').draw();
                }, 50); // Small delay to ensure select changes have propagated
            });
    
            // Function to apply all filters at once
            function applyFilters() {
                let positionVal = $('#position-filter').val();
                let goalVal = $('#goal-filter').val();
                let assistVal = $('#assist-filter').val();
                let pointsVal = $('#points-filter').val();
                let priceMinVal = $('#price-filter').val();
                let priceMaxVal = $('#price-max-filter').val();
                
                // Clear previous filters
                table.search('').columns().search('');
                $.fn.dataTable.ext.search = [];
                
                // Apply position filter (column 7 - Positions)
                if (positionVal) {
                    table.column(7).search(positionVal, true, false);
                }
                
                // Setup numeric filters
                if (goalVal || assistVal || pointsVal || priceMinVal || priceMaxVal) {
                    $.fn.dataTable.ext.search.push(
                        function(settings, data, dataIndex) {
                            let pass = true;
                            
                            // Goals filter (column 10)
                            if (goalVal && pass) {
                                let value = parseFloat(data[10]) || 0;
                                pass = value >= parseFloat(goalVal);
                            }
                            
                            // Assists filter (column 11)
                            if (assistVal && pass) {
                                let value = parseFloat(data[11]) || 0;
                                pass = value >= parseFloat(assistVal);
                            }
                            
                            // Total Points filter (column 5)
                            if (pointsVal && pass) {
                                let value = parseFloat(data[5]) || 0;
                                pass = value >= parseFloat(pointsVal);
                            }
                            
                            // Price filters (column 3 - Cost)
                            if ((priceMinVal || priceMaxVal) && pass) {
                                // Convert price string to numeric value for comparison
                                let costString = data[3];
                                // Remove non-numeric characters if present and convert to a number
                                let costValue = parseFloat(costString.replace(/[^0-9.]/g, '')) * 1000000 || 0;
                                
                                // Check minimum price
                                if (priceMinVal && pass) {
                                    pass = costValue >= parseFloat(priceMinVal);
                                }
                                
                                // Check maximum price
                                if (priceMaxVal && pass) {
                                    pass = costValue <= parseFloat(priceMaxVal);
                                }
                            }
                            
                            return pass;
                        }
                    );
                }
                
                // Apply all filters
                table.draw();
            }
            
            // Dark mode toggle
            $('#toggleDarkMode').on('click', function() {
                $('body').toggleClass('bg-dark text-white');
                $('.filters-card, .table-container').toggleClass('bg-dark text-white');
                
                let isDarkMode = $('body').hasClass('bg-dark');
                $(this).html(isDarkMode ? 
                    '<i class="fas fa-sun"></i> Light Mode' : 
                    '<i class="fas fa-moon"></i> Dark Mode');
            });
        });
    </script>
</body>
</html>